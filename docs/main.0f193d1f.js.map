{"version":3,"sources":["js/main.js"],"names":["canvas","context","masu","blocks","score","status","gameOverLabel","Block","x","y","_classCallCheck","pos","target","n","Math","random","targetIndex","chars","_createClass","key","value","vx","sign","vy","grad","createRadialGradient","addColorStop","concat","fillStyle","fillRect","font","textAlign","char","length","fillText","init","document","getElementById","getContext","textBaseline","addEventListener","event","cntMoveBlocks","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","initGame","update","i","Array","fill","addBlock","masu0","push","floor","block","check","dir","cnt","tx","ty","moveBlocks","sx","sy","dx","dy","ex","ey","width","height","move","moving","draw","textContent","window","requestAnimationFrame","onclick","onload"],"mappings":"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","file":"main.0f193d1f.js","sourceRoot":"..","sourcesContent":["let canvas, context;\nlet masu, blocks;\nlet score, status, gameOverLabel;\n\nclass Block {\n  constructor(x, y) {\n    this.pos = {x: x * 150, y: y * 150};\n    this.target = {x: x, y: y} // ÁßªÂãïÂÖà„ÅÆ„Éû„Çπ„ÅÆ‰ΩçÁΩÆ\n    this.n = 0 // „Çπ„Ç≥„Ç¢\n    if (Math.random() < 0.2) this.n++; // 20%„ÅÆÁ¢∫Áéá„ÅßÂàùÊúüÂÄ§Â§âÊõ¥\n    this.status = \"stop\";\n    this.targetIndex = -1;\n    this.chars = [\"üê≠\", \"üêÆ\", \"üêØ\", \"üê∞\", \"üê≤\", \"üêç\", \"üê¥\", \"üêë\", \"üêµ\", \"üêî\", \"üê∂\", \"üêó\"];\n  }\n\n  move() {\n    const vx = Math.sign(this.target.x * 150 - this.pos.x) * 15;\n    const vy = Math.sign(this.target.y * 150 - this.pos.y) * 15;\n    this.pos = {x: this.pos.x + vx, y: this.pos.y + vy};\n    if ((vx === 0) && (vy === 0)) this.status = \"stop\";\n  }\n\n  draw() {\n    // ËÉåÊôØ„ÇíÊèèÁîª\n    const grad = context.createRadialGradient(this.pos.x + 75, this.pos.y + 75, 30, this.pos.x + 75, this.pos.y + 75, 75);\n    grad.addColorStop(0.0, `hsl(${(this.n + 2) * 30}, 80%, 88%)`);\n    grad.addColorStop(1.0, `hsl(${(this.n + 2) * 30}, 90%, 80%)`);\n    context.fillStyle = grad;\n    context.fillRect(this.pos.x + 6, this.pos.y + 6, 138, 138);\n    // ÁµµÊñáÂ≠ó„ÇíÊèèÁîª\n    context.fillStyle = \"#3f4144\";\n    context.font = \"64px sans-serif\";\n    context.textAlign = \"center\";\n    const char = this.chars[this.n % this.chars.length];\n    context.fillText(char, this.pos.x + 75, this.pos.y + 80);\n    // n„ÅÆË°®Á§∫\n    context.fillStyle = `hsl(${(this.n + 2) * 30}, 60%, 20%)`;\n    context.font = \"bold 32px sans-serif\";\n    context.textAlign = \"centor\";\n    context.fillText(this.n + 1, this.pos.x + 75, this.pos.y + 30);\n  }\n}\n\nconst init = () => {\n  canvas = document.getElementById(\"board\");\n  context = canvas.getContext(\"2d\");\n  context.textBaseline = \"middle\";\n  // „Ç≠„Éº„Ç§„Éô„É≥„Éà\n  document.addEventListener(\"keydown\", (event) => {\n    if (status !== \"ready\") return;\n    const key = event.key;\n    const dir = {ArrowUp: \"up\", ArrowDown: \"down\", ArrowLeft: \"left\", ArrowRight: \"right\"}[key];\n    if (cntMoveBlocks(dir)) {\n      status = \"move\"\n    }\n  });\n  initGame();\n  update();\n}\n\nconst initGame = () => {\n  masu = [];\n  blocks = [];\n  for (let i = 0; i < 4; i++) {\n    masu[i] = new Array(4).fill(null);\n  }\n  addBlock();\n  addBlock();\n  score = 0;\n  gameOverLabel = \"\";\n  status = \"ready\";\n}\nconst addBlock = () => {\n  const masu0 = new Array();\n  // Á©∫„ÅÑ„Å¶„ÅÑ„Çã„Éû„Çπ„ÅÆ‰ΩçÁΩÆ\n  for (let y = 0; y < 4; y++) {\n    for (let x = 0; x < 4; x++) {\n      if (masu[y][x] === null) masu0.push({x: x, y: y});\n    }\n  }\n  // „É©„É≥„ÉÄ„É†„Å´„Éû„Çπ„ÇíÈÅ∏Êäû\n  if (masu0.length > 0) {\n    const index = Math.floor(Math.random() * masu0.length);\n    const pos = masu0[index];\n    const block = new Block(pos.x, pos.y);\n    blocks.push(block);\n    masu[pos.y][pos.x] = blocks.length - 1;\n  }\n  // Èö£„Å´Á≠â„Åó„ÅÑn„ÇíÊåÅ„Å§„Éñ„É≠„ÉÉ„ÇØ„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ\n  if (masu0.length === 1) {\n    let check = true;\n    for (let y = 0; y < 4; y++) {\n      for (let x = 0; x < 4; x++) {\n        if (check && (masu[y][x] !== null)) {\n          const n = blocks[masu[y][x]].n;\n          if ((y < 3) && (blocks[masu[y + 1][x]].n === n)) {\n            check = false;\n          }\n          if ((x < 3) && (blocks[masu[y][x + 1]].n === n)) {\n            check = false;\n          }\n        }\n      }\n    }\n    if (check) {\n      gameOverLabel = \"GAMEOVER\";\n    }\n  }\n}\n\n// cntMoveBlocks „Éñ„É≠„ÉÉ„ÇØ„ÅÆÁßªÂãïÂèØËÉΩÂõûÊï∞„Çí„Ç´„Ç¶„É≥„Éà\n\nconst cntMoveBlocks = (dir) => {\n  let cnt = 0;\n  for (let y = 0; y < 4; y++) {\n    for (let x = 0; x < 4; x++) {\n      let tx = x;\n      let ty = y;\n      if (dir === \"right\") tx = 3 - x\n      else if (dir === \"down\") ty = 3 - y;\n      if (masu[ty][tx] !== null) {\n        cnt += moveBlocks(dir, tx, ty);\n      }\n    }\n  }\n  return cnt;\n}\n\nconst moveBlocks = (dir, x, y) => {\n  let cnt = 0;\n  let check = false;\n  // ÁèæÂú®„ÅÆ‰ΩçÁΩÆ„ÄÅÁßªÂãïÊñπÂêë„ÄÅÁßªÂãïÁµÇ‰∫Ü‰ΩçÁΩÆ\n  let [sx, sy, dx, dy, ex, ey] = [x, y, 0, 0, x, y];\n  // ÁßªÂãïÊñπÂêë„Å´„Çà„Å£„Å¶ÁßªÂãïÁµÇ‰∫Ü‰ΩçÁΩÆ„ÇíË®≠ÂÆö\n  if (dir === \"up\") [dy, ey] = [-1, 0];\n  else if (dir === \"down\") [dy, ey] = [1, 3];\n  else if (dir === \"left\") [dx, ex] = [-1, 0];\n  else if (dir === \"right\") [dx, ex] = [1, 3];\n  // ÁßªÂãïÁµÇ‰∫Ü‰ΩçÁΩÆ„Åæ„ÅßÁßªÂãï\n  while ((ex !== sx) || (ey !== sy)) {\n    const [tx, ty] = [sx + dx, sy + dy];\n    const block = blocks[masu[sy][sx]];\n    const target = blocks[masu[ty][tx]];\n    // ÁßªÂãïÂÖà„ÅåÁ©∫„ÅÆÂ†¥Âêà\n    if (masu[ty][tx] === null) {\n      masu[ty][tx] = masu[sy][sx];\n      masu[sy][sx] = null;\n      block.target = {x: tx, y: ty};\n      block.status = \"move\";\n      cnt++;\n    } else if ((block.n === target.n) && (target.targetIndex === -1)) {\n      block.target = {x: tx, y: ty};\n      block.status = \"move\";\n      block.targetIndex = masu[ty][tx];\n      masu[ty][tx] = masu[sy][sx];\n      masu[sy][sx] = null;\n      cnt = cnt + 1;\n      check = true;\n    }\n    [sx, sy] = [tx, ty];\n    if (check) break; // Âêà‰Ωì„Åô„Çã„Éñ„É≠„ÉÉ„ÇØ„Åå„ÅÇ„Çã„Å™„ÇâÁπ∞„ÇäËøî„ÅóÁµÇ‰∫Ü\n  }\n  return cnt\n}\n\nconst update = () => {\n  // „Éñ„É≠„ÉÉ„ÇØ„ÅÆÁßªÂãï\n  context.fillStyle = \"#f3f3f6\";\n  context.fillRect(0, 0, canvas.width, canvas.height);\n  // blocks„ÅÆË¶ÅÁ¥†„ÇíÁßªÂãï„Åï„Åõ„Çã\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n    if (block.status === \"move\") {\n      block.move();\n    }\n    // status„Ååstop„ÅßÂêà‰Ωì„Åô„Çã„Éñ„É≠„ÉÉ„ÇØ„Åå„ÅÇ„Çã„Å™„Çâ\n    if ((block.status === \"stop\") && (block.targetIndex !== -1)) {\n      // Âêà‰ΩìÂÖà„Éñ„É≠„ÉÉ„ÇØ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí dead „Å´Ë®≠ÂÆö\n      blocks[block.targetIndex].status = \"dead\";\n      // Âêà‰ΩìÂÖà„Éñ„É≠„ÉÉ„ÇØ„ÅÆ„Çπ„Ç≥„Ç¢„ÇíÂä†ÁÆó\n      block.n = block.n + 1;\n      block.targetIndex = -1;\n      score += block.n;\n    }\n  }\n  // Êû†Á∑ö„ÇíÊèèÁîª\n  context.fillStyle = \"#d2d6dd\";\n  for (let i = 0; i < 5; i++) {\n    context.fillRect(0, i * 150 - 2, 600, 4);\n    context.fillRect(i * 150 - 2, 0, 4, 600);\n  }\n  // ÊèèÁîª\n  let moving = false;\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n    if (block.status === \"move\") moving = true;\n    if (block.status !== \"dead\") block.draw();\n  }\n  // ÁßªÂãï„ÅåÂÆå‰∫Ü„Åó„Åü„ÇâÊñ∞„Åó„ÅÑ„Éñ„É≠„ÉÉ„ÇØ„ÇíËøΩÂä†\n  if (!moving && (status === \"move\")) {\n    addBlock();\n    status = \"ready\";\n  }\n  // #score „Å´„Çπ„Ç≥„Ç¢„ÇíË°®Á§∫\n  document.getElementById(\"score\").textContent = score;\n  document.getElementById(\"gameOverLabel\").textContent = gameOverLabel;\n  window.requestAnimationFrame(update);\n}\n\n// initGameButton„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„ÇâinitGame„ÇíÂëº„Å≥Âá∫„Åô\ndocument.getElementById(\"initGameButton\").onclick = initGame;\n\ndocument.onload = init();\n"]}